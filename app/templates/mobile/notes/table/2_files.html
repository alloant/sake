<span id="row_{{note.id}}_files">
    <button type="button" class="p-0 btn btn-sm dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown">
    {% if note.files|length == 0 %}
        <i class="bi bi-journal text-warning"></i>
      {% elif note.permanent and not reg[2] %}
        <i class="bi bi-journal-medical text-danger" data-bs-toggle="tooltip" title="{{gettext('Only permanente')}}"></i>
      {% else %}
        <i class="bi bi-journal-text"></i>
      {% endif %}

      <span class="visually-hidden">Toggle Dropdown</span>
    </button>

  <ul class="dropdown-menu">
    <li><h5 class="dropdown-header text-decoration-underline fw-bold">Files</h5></li>
    {% if reg[2] and note.flow == 'in' or note.reg!='mat' and not reg[2] or note.reg=='mat' and note.sender_id==current_user.id %}
      <li><a  class="dropdown-item small fw-light" 
            href="{{session['link']}}/d/f/{{note.permanent_link}}"
            target="_blank"
            role="button">
          <i class="bi bi-folder-fill text-warning"></i> {{note.fullkey_folder}}
          </a>
      </li>
    {% endif %}
    {% for file in note.files %}
      {% if not reg[2] or reg[2] and (file.subject == '' or reg[2] in file.subject.split(','))  %}
        <li><a  class="dropdown-item small fw-light" 
              hx-get="/read_note?note={{note.id}}&reg={{reg}}&file_clicked={{file.id}}"
              hx-swap="none"
              hx-on:htmx:after-request="window.open('{{file.link}}')"
              role="button">
            <i class="bi {{file.bi_icon}}"></i> {{file.name}}
          </a>
        </li>
      {% endif %}
    {% endfor %}
    
    {% for ref in note.ref %}
      {% if reg[2] and ref.reg != 'mat' and (ref.sender.alias == reg[2] or reg[2] in ref.receivers) or not reg[2] %}
        <li>
          {% if reg[0] == 'des' %}
            <a  class="text-decoration-none"
                hx-on:click="navigator.clipboard.writeText('{{ref.content}}')"
                role=button>
              <h5 class="dropdown-header text-decoration-underline fw-bold">{{ref.fullkey}}: {{ref.content}}
                ({% with note = ref %}{% include 'notes/table/2_involved.html' %}{% endwith %})
              </h5>
            </a>
          {% else %}
            <h5 class="dropdown-header text-decoration-underline fw-bold">{{ref.fullkey}}: {{ref.content}}
            </h5>
          {% endif %}
        </li>
        {% if ref.reg!='mat' or ref.reg=='mat' and ref.is_involve(reg,current_user) %}
          {% for file in ref.files %}
            {% if not reg[2] or reg[2] and (file.subject == '' or reg[2] in file.subject.split(','))  %}
              <li><a  class="dropdown-item small fw-light" 
                    hx-get="/read_note?note={{ref.id}}&reg={{reg}}&file_clicked={{file.id}}"
                    hx-swap="none"
                    hx-on:htmx:after-request="window.open('{{file.link}}')"
                    role="button">
                  <i class="bi {{file.bi_icon}}"></i> {{file.name}}
                </a>
              </li>
            {% endif %}
          {% endfor %}
        {% endif %}
      {% endif %}
    {% endfor%}

  </ul>
</span>
